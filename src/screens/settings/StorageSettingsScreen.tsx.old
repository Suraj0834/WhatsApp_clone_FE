import React, { useState, useEffect } from 'react';
import { View, StyleSheet, ScrollView, Text, FlatList } from 'react-native';
import { List, ProgressBar, Button, Divider } from 'react-native-paper';
import { useNavigation } from '@react-navigation/native';

interface StorageItem {
    type: string;
    size: number;
    count: number;
}

export const StorageSettingsScreen = () => {
    const navigation = useNavigation<any>();
    const [totalStorage, setTotalStorage] = useState(0);
    const [storageItems, setStorageItems] = useState<StorageItem[]>([
        { type: 'Photos', size: 450, count: 245 },
        { type: 'Videos', size: 1200, count: 89 },
        { type: 'Documents', size: 120, count: 34 },
        { type: 'Voice Messages', size: 85, count: 156 },
        { type: 'Audio', size: 200, count: 45 },
        { type: 'Stickers', size: 15, count: 120 },
    ]);

    useEffect(() => {
        const total = storageItems.reduce((sum, item) => sum + item.size, 0);
        setTotalStorage(total);
    }, [storageItems]);

    const formatSize = (mb: number) => {
        if (mb >= 1024) {
            return `${(mb / 1024).toFixed(1)} GB`;
        }
        return `${mb} MB`;
    };

    const renderStorageItem = ({ item }: { item: StorageItem }) => {
        const percentage = (item.size / totalStorage) * 100;
        return (
            <View style={styles.storageItem}>
                <View style={styles.itemHeader}>
                    <Text style={styles.itemType}>{item.type}</Text>
                    <Text style={styles.itemSize}>{formatSize(item.size)}</Text>
                </View>
                <ProgressBar
                    progress={percentage / 100}
                    color="#25D366"
                    style={styles.progressBar}
                />
                <Text style={styles.itemCount}>{item.count} items</Text>
            </View>
        );
    };

    return (
        <ScrollView style={styles.container}>
            <View style={styles.summaryCard}>
                <Text style={styles.summaryTitle}>Total Storage Used</Text>
                <Text style={styles.summarySize}>{formatSize(totalStorage)}</Text>
                <ProgressBar progress={0.65} color="#25D366" style={styles.summaryProgress} />
                <Text style={styles.summaryText}>65% of available space</Text>
            </View>

            <View style={styles.header}>
                <Text style={styles.headerText}>STORAGE BREAKDOWN</Text>
            </View>

            <FlatList
                data={storageItems}
                renderItem={renderStorageItem}
                keyExtractor={(item) => item.type}
                scrollEnabled={false}
            />

            <Divider style={styles.divider} />

            <View style={styles.header}>
                <Text style={styles.headerText}>NETWORK USAGE</Text>
            </View>

            <List.Item
                title="Network usage"
                description="View data usage statistics"
                left={() => <List.Icon icon="chart-line" color="#25D366" />}
                onPress={() => {}}
            />

            <Divider style={styles.divider} />

            <View style={styles.header}>
                <Text style={styles.headerText}>AUTO-DOWNLOAD MEDIA</Text>
            </View>

            <List.Item
                title="When using mobile data"
                description="Photos"
                left={() => <List.Icon icon="cellphone" color="#25D366" />}
                onPress={() => {}}
            />

            <List.Item
                title="When using Wi-Fi"
                description="All media"
                left={() => <List.Icon icon="wifi" color="#25D366" />}
                onPress={() => {}}
            />

            <List.Item
                title="When roaming"
                description="No media"
                left={() => <List.Icon icon="airplane" color="#25D366" />}
                onPress={() => {}}
            />

            <Divider style={styles.divider} />

            <View style={styles.actionButtons}>
                <Button
                    mode="contained"
                    onPress={() => navigation.navigate('ManageStorage')}
                    style={styles.manageButton}
                    labelStyle={styles.buttonText}
                >
                    MANAGE STORAGE
                </Button>
                <Button
                    mode="outlined"
                    onPress={() => {}}
                    style={styles.clearButton}
                    labelStyle={styles.clearButtonText}
                >
                    CLEAR CACHE
                </Button>
            </View>

            <View style={styles.infoBox}>
                <Text style={styles.infoText}>
                    Free up space by deleting items that have been forwarded many times or are larger than a certain size
                </Text>
            </View>
        </ScrollView>
    );
};

const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#fff',
    },
    summaryCard: {
        margin: 16,
        padding: 20,
        backgroundColor: '#F7F8FA',
        borderRadius: 12,
        alignItems: 'center',
    },
    summaryTitle: {
        fontSize: 14,
        color: '#667781',
        marginBottom: 8,
    },
    summarySize: {
        fontSize: 32,
        fontWeight: '700',
        color: '#000',
        marginBottom: 16,
    },
    summaryProgress: {
        width: '100%',
        height: 8,
        borderRadius: 4,
        marginBottom: 8,
    },
    summaryText: {
        fontSize: 13,
        color: '#667781',
    },
    header: {
        paddingHorizontal: 16,
        paddingVertical: 12,
        backgroundColor: '#F7F8FA',
    },
    headerText: {
        fontSize: 13,
        color: '#667781',
        fontWeight: '600',
    },
    storageItem: {
        paddingHorizontal: 16,
        paddingVertical: 16,
        borderBottomWidth: 1,
        borderBottomColor: '#F0F0F0',
    },
    itemHeader: {
        flexDirection: 'row',
        justifyContent: 'space-between',
        marginBottom: 8,
    },
    itemType: {
        fontSize: 16,
        fontWeight: '500',
        color: '#000',
    },
    itemSize: {
        fontSize: 15,
        color: '#25D366',
        fontWeight: '600',
    },
    progressBar: {
        height: 6,
        borderRadius: 3,
        marginBottom: 6,
    },
    itemCount: {
        fontSize: 13,
        color: '#667781',
    },
    divider: {
        height: 8,
        backgroundColor: '#F7F8FA',
    },
    actionButtons: {
        paddingHorizontal: 16,
        paddingVertical: 20,
    },
    manageButton: {
        backgroundColor: '#25D366',
        marginBottom: 12,
    },
    clearButton: {
        borderColor: '#F44336',
    },
    buttonText: {
        fontSize: 14,
        fontWeight: '700',
    },
    clearButtonText: {
        color: '#F44336',
        fontSize: 14,
        fontWeight: '700',
    },
    infoBox: {
        margin: 16,
        padding: 16,
        backgroundColor: '#F7F8FA',
        borderRadius: 8,
    },
    infoText: {
        fontSize: 13,
        color: '#667781',
        lineHeight: 18,
        textAlign: 'center',
    },
});
